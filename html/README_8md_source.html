<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ATTPCROOT: /mnt/simulations/attpcroot/adam/ATTPCROOTv2/README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ATTPCROOT
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">A ROOT-based framework for analyzing data from active target detectors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/mnt/simulations/attpcroot/adam/ATTPCROOTv2/README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="README_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ATTPCROOT is a ROOT-based (root.cern.ch) framework to analyze data of active target detectors including the ATTPC (Active Target Time Projection Chamber) detector and the p-ATTPC (Prototype). For reference http://ribf.riken.jp/ARIS2014/slide/files/Jun2/Par2B06Bazin-final.pdf. The detector is based at the NSCL but experiments are performed at other facilities as well (Notre Dame, TRIUMF, Argonne...).</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;The framework allows the end user to unpack and analyze the data, as well as perform realistic simulations based on a Virtual Monte Carlo (VMC) package. The framework needs external libraries (FairSoft and FairRoot https://fairroot.gsi.de/) to be compiled and executed, which are developed by other groups and not directly supported by the AT-TPC group. Please refer to their forums for installation issues of these packages.</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;There was also some documentation written as part of Alexander Carl&#39;s 2019 thesis which can be found [here](https://publications.nscl.msu.edu/thesis/%20Carls_2019_6009.pdf)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;# Table of contents</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;- [For developers](#for-developers)</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  - [Coding conventions](#coding-conventions)</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    - [Object Ownership](#object-ownership)</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    - [Formatting code for PRs](#formatting-code-for-pull-requests)</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    - [Adding a class](#adding-a-class)</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    - [Adding a task](#adding-a-task)</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    - [Adding a library](#adding-a-library)</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;- [Installation](#installation)</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  - [On NSCL/FRIB cluster](#installation-on-frib-cluster)</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  - [Building from scratch](#installation-from-scratch)</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  - [Linking against ATTPCROOT](#linking-against-attpcroot)</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;# Installation</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;## Installation on FRIB cluster</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;ROOT and FairROOT are already installed on the system. As of 1/14/2021 the IT department has decided they no longer want to maintain the installation, the the process has changed. The prequisites for installation can now bew found in the directory `/mnt/simulation/attpcroot/fair_install_18.6/`. It is recomended to use the `env_fishtank.sh` script to set the required modules and enviroment variables that used to be handled just through the fishtank module system.</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;To install ATTPCROOT checkout the repository from github and source the proper enviroment script. This code requires an out of source build, so create a folder in the repository to build the code and cd into it. From this directory you can call CMake to configure the build, setting the CMAKE_PREFIX_PATH so cmake can find all of the prequisites. Then you can build the source. </div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;```</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;git clone https://github.com/ATTPC/ATTPCROOTv2.git</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;cd ATTPCROOTv2</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;source env_fishtank.sh</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;mkdir build</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;cd build</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;cmake -DCMAKE_PREFIX_PATH=/mnt/simulations/attpcroot/fair_install_18.6/ ../</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;make install -j 4 </div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;source config.sh</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;```</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;After the source builds, you should be good to go. The CMake script will output a configuration file in the build directory called `config.sh`. This script should be sourced before building or running any macros. For those working on the FRIB fishtank computers, the enviroment script `env_fishtank.sh` can be sourced instead.</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;## Installation from scratch</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;The ATTPCROOT code depends on the following external packages, with tested version numbers:</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;- Required dependencies</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  - Compiler with support for C++14 standard</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  - [Xerces](https://xerces.apache.org/) (3.2.3)</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  - [FairSoft](https://github.com/FairRootGroup/FairSoft/releases/tag/apr21p2) (apr21 with ROOT fftw3 module)</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  - [FairRoot](https://github.com/FairRootGroup/FairRoot/releases/tag/v18.6.5) (18.6.5)</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  - [HDF5](https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.10/hdf5-1.10.4/src/) (1.10.4)</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    - [PCL](https://github.com/PointCloudLibrary/pcl/releases/tag/pcl-1.10.1) (1.10.1)</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    - [FLANN](https://github.com/flann-lib/flann/releases/tag/1.9.1) (1.9.1)</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    - [Eigen](https://gitlab.com/libeigen/eigen/-/releases/3.3.9) (3.3.9)</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;- Optional dependencies </div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  - [GenFit](https://github.com/Yassid/GenFit)</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  - [HiRAEVT](https://github.com/nscl-hira/HiRAEVT)</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  - [IWYU](https://github.com/include-what-you-use/include-what-you-use) for static analysis</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;### Installation of prequisites</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;Coppied below are the instructions for building and installing the prequisites on FRIB fishtank. Hopefully they will be of use installing the software on other systems:</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;#### FairSoft</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;Run `module purge`, `module load gnu/gcc/9.3`, `module load xerces/3.2.3`</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;run `export XercesC_ROOT=/mnt/misc/sw/x86_64/Debian/10/xerces/3.2.3/`</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;Follow instructions here https://github.com/FairRootGroup/FairSoft/blob/master/legacy/README.md, for the release apr21_patches. You will probably have to bootstrap cmake to get the correct verison.</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;It will fail when it gets to installing root, because it can&#39;t build XROOTD (it is missing the header files from openssl, on a personal computer this could probably be fixed by installing libssl-dev). On fishtank, we are just going to disable this module (we expect all of out data to be accessed locally) and at the same time **enable the builtin_fftw3 module**.</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;I decided to do this by modifying the cmake cache file for root, found at Build/root/CMakeCache.txt by changin the lines:</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;1. `xrootd:BOOL=ON` to `xrootd:BOOL=OFF`</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;2. `builtin_xrootd:BOOL=ON` to `builtin_xrootd:BOOL=OFF`</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;3. `builtin_fftw3:BOOL=OFF` to `builtin_fftw3:BOOL=ON`</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;4. `fftw3:BOOL=OFF` to `fftw3:BOOL=ON`</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;#### FairRoot 18.6.5</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;Modified directions from https://github.com/FairRootGroup/FairRoot</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;1. `export SIMPATH=FairSoftInstallDirectory`</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;2. Clone the FairRoot repository `git clone -b v18.6_patches https://github.com/FairRootGroup/FairRoot.git`</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;3. Create the build directory `mkdir /mnt/analysis/e12014/fair_install/FairRoot/`</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;4. Run cmake in the build directory `cmake -DCMAKE_INSTALL_PREFIX=/mnt/simulations/attpcroot/fair_install_18.6/FairRoot /mnt/simulations/attpcroot/fair_install_18.6/src/FairRoot/`</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;5. Build and install the code in the build directory `make` `make install`</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;#### HDF5 1.10.4</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;1. Grab source code `wget https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.10/hdf5-1.10.4/src/hdf5-1.10.4.tar.gz`</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;2. Untar source `tar -xvf hdf5-1.10.4.tar.gz`</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;3. Make build directory `mkdir /mnt/analysis/e12014/fair_install/hdf5`</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;4. Run cmake `cmake -DCMAKE_INSTALL_PREFIX=/mnt/simulations/attpcroot/fair_install_18.6/hdf5 /mnt/simulations/attpcroot/fair_install_18.6/src/hdf5-1.10.4`</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;5. Make and install `make &amp;&amp; make install`</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;#### FLANN 1.9.1 (Required for PCL)</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;1. Grab the source `wget https://github.com/flann-lib/flann/archive/refs/tags/1.9.1.tar.gz`</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;2. Unpack the source `tar -xzf 1.9.1.tar.gz`</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;3. Create a build directory `mkdir /mnt/analysis/e12014/fair_install/flann/`</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;4. Modify flann per issue [#369](https://github.com/flann-lib/flann/issues/369) to build with newer versions of cmake:</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;```</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;touch src/cpp/empty.cpp</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;sed -e &#39;/add_library(flann_cpp SHARED/ s/&quot;&quot;/empty.cpp/&#39; \</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;-e &#39;/add_library(flann SHARED/ s/&quot;&quot;/empty.cpp/&#39; \</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;-i src/cpp/CMakeLists.txt</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;```</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;5. In the build directory, run cmake `cmake -DCMAKE_INSTALL_PREFIX=/mnt/simulations/attpcroot/fair_install_18.6/flann /mnt/simulations/attpcroot/fair_install_18.6/src/flann`</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;6. `make &amp;&amp; make install` (might yell about pyFlann but idc)</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;#### Eigen3 (Required for PCL)</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;1. Grab the source `wget https://gitlab.com/libeigen/eigen/-/archive/3.3.9/eigen-3.3.9.tar.gz`</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;2. Untar file `tar -xzf eigen-3.3.9.tar.gz`</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;3. Make build directory `mkdir /mnt/analysis/e12014/fair_install/eigen3`</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;4. `cmake -DCMAKE_INSTALL_PREFIX=/mnt/simulations/attpcroot/fair_install_18.6/eigen /mnt/simulations/attpcroot/fair_install_18.6/src/eigen-3.3.9/`</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;5. Install `make install`</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;#### PCL 1.10.1 (Optional dependency)</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;0. Make sure FLANN, and Eigen are all installed</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;1. Grab the source code `https://github.com/PointCloudLibrary/pcl/archive/refs/tags/pcl-1.10.1.tar.gz`</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;2. Untar source `tar -xvf pcl-1.10.1.tar.gz`</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;3. Create build directory `mkdir /mnt/analysis/e12014/fair_install/pcl`</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;4. In build directory, run cmake set to use the boost libraries from fairsoft</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;```</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;cmake -DCMAKE_INSTALL_PREFIX=/mnt/simulations/attpcroot/fair_install_18.6/pcl -DCMAKE_BUILD_TYPE=Release -DCMAKE_PREFIX_PATH=/mnt/simulations/attpcroot/fair_install_18.6/flann -DBOOST_INCLUDEDIR=/mnt/simulations/attpcroot/fair_install_18.6/FairSoft/include -DBOOST_LIBRARYDIR=/mnt/simulations/attpcroot/fair_install_18.6/FairSoft/lib/ -DBoost_NO_SYSTEM_PATHS=ON /mnt/simulations/attpcroot/fair_install_18.6/src/pcl-pcl-1.10.1/</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;```</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;5. Build and install the code `make` and `make install`</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;#### GenFit (Optional dependency)</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;1. Get the source `git clone https://github.com/Yassid/GenFit.git`</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;2. Make build directory `mkdir /mnt/analysis/e12014/fair_install/genfit`</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;3. Run cmake from build directory, making sure it can find our version of root </div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;```</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;cmake -DCMAKE_INSTALL_PREFIX=/mnt/simulations/attpcroot/fair_install_18.6/GenFit -DCMAKE_PREFIX_PATH=/mnt/simulations/attpcroot/fair_install_18.6/FairSoft/ -DBUILD_TESTING=OFF /mnt/simulations/attpcroot/fair_install_18.6/src/GenFit/</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;```</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;4. Build and install `make` and `make install`</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;### HiRAEVT (Optional dependency)</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;1. Get the source `git clone https://github.com/nscl-hira/HiRAEVT.git`</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;2. Create build directory `mkdir /mnt/analysis/e12014/fair_install/HiRAEVT`</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;3. Run cmake in build directory, disabling unpacking modules </div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;```</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;cmake -DCMAKE_INSTALL_PREFIX=/mnt/simulations/attpcroot/fair_install_18.6/HiRAEVT -DCMAKE_PREFIX_PATH=/mnt/simulations/attpcroot/fair_install_18.6/FairSoft/ -DBUILD_UNPACKERS=OFF /mnt/simulations/attpcroot/fair_install_18.6/src/HiRAEVT/</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;```</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;4. Build and install `make` and `make install`</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;## Linking against ATTPCROOT</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;ATTPCROOT can be included in an external project using CMake. When installed (`make install`) ATTPCROOT will export information on its targets (libraries) and dependencies for others to use. By default, the installation path is `build/install` but this can be changed by setting the `CMAKE_INSTALL_PREFIX` variable when building the ATTPCROOT code.</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;The simplest use involves making sure the install directory sits on your project&#39;s `CMAKE_PREFIX_PATH` and using CMake&#39;s build in `find_package(ATTPCROOT)` command, and then adding the libraries required with `target_link_libraries()`. A minimally fuctioning CMakeLists.txt for an external project might look something like this:</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;```</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;list(APPEND CMAKE_PREFIX_PATH /path/to/ATTPCROOT/install/dir)</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;find_package(ATTPCROOT REQUIRED)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;add_library(yourLib SHARED yourLib.cpp)</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;target_link_libraries(yourLib PUBLIC ATTPCROOT::AtData)</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;```</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;This will build a shared library called `libyourLib.so` and link it against `libAtData.so` and all its dependencies.</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;# For developers</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;## Coding conventions</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;Pull requests submitted should have the code formated in the [ROOT style](https://root.cern/contribute/coding_conventions/). Never include a header file when a forward decleration is sufficient. Only include header files for base classes or classes that are used by value in the class definition. The static analyzer IWYU helps with this, but will ocassionally get things wrong, so use your judgment.</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;All data members of a class should be private or protected and begin with the letter `f`, followed by a capital letter. All public member functions should begin with a capital letter. Following ROOT&#39;s style guide, private data members should be declared first, followed by the private static members, the private methods and the private static methods. Then the protected members and methods, and finally the public methods. Add trivial get or setters directly in the class definition. Add more complex inlines (longer than one line) at the bottom of the .h file. </div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;Avoid raw c types for anything that might be written to disk (any memeber variable), instead use ROOT defined types like `Int_t` defined in `&lt;Rtypes.h&gt;`. If any changes are made to the memory layout of a class, the version number in the ROOT macro `ClassDef` needs to be incremented. If the class overrides any virtual function, the macro `ClassDefOverride` should be used instead.</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;An object should always be created in a valid state. Instance variables that are set to the same value in all constructors should be instantiated in the header file. Variables whose initial value can change depending on the constructor called, should be intialized in the constructor&#39;s braced-init-list. Prefer delegating constructors to repeating code.</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;Header files refrencing this code base should be included using quotes i.e. `#include &quot;header.h&quot;`. Header files from dependencies should be included using angle brackets i.e. `#include &lt;Rtypes.h&gt;`. This is the syntax assumed by the custom mapping file we use for running IWYU and will lead to false errors running the linter if deviated from. </div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;### Object ownership</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;When we talk about object ownership we mean the right to free the associated resources (in otherwords `delete` an object). ROOT has some weird quirks of ownership, where you may not own the things you think you do. This is particularly true of histograms, TTrees, and TEventLists. Details of ROOT ownership practices can be found [here](https://root.cern.ch/root/htmldoc/guides/users-guide/ObjectOwnership.html). For everything not discussed here we use the following conventions (modified from the [C++ Core Guidlines](https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#S-resource):</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;* Express ownership explicitly through use of smart pointers `std::unique_ptr` and `std::shared_ptr`. This means there should never be an explicit call to `new` or `delete`. The exception to this is ROOT cannot yet create streamer for writing `std::shared_ptr` to disk. In that case, a raw pointer (`T*`) with a comment explaining the intended ownership is acceptible until ROOT fixes that problem.</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;* Prefer `std::unique_ptr` over `std::shared_ptr` unless ownership must be shared.</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;* Raw pointers (`T*`) and raw references are non-owning (`T&amp;`). They should never be deleted. </div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;* Take smart pointers as parameters only to express lifetime semantics (transfer ownership)</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;* In interfaces (headers), use raw pointers to denote individual objects. Arrays should be represented by a containter (unless it is c-style string).</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;### Formatting code for pull requests</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;Before submitting a pull request, reformat the code using `clang-format`. If run from within the repository it will pick up the `.clang-format` file detail the style. This file is also reproduced on the page detailing ROOT the ROOT coding style. If for some reason you need a section of code to not be formatted, you can turn off formatting using comment flags. Formatting of code is turned off with the comment `// clang-format off` and re-enabled with the comment `// clang-format on`. This process can be simplified using the command `git-clang-format` which when given no options will tun `clang-format` on all lines of code that differ between the working directory and HEAD. Detailed documentation is [here](https://github.com/llvm-mirror/clang/blob/master/tools/clang-format/git-clang-format).</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;Before submitting a pull request run the tests as described [below](#running-tests).</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;## Adding a class</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;Classes, for example a new generator, can be added by creating the header and source files. In the library directory the `CMakeLists.txt` file must be edited to add any include directories needed as well as add the source file so CMake knows to compile it. In addition the class should be added the the local `LinkDef.h` file, if needed. Classes should respect the naming convention of `AtName.cxx` for source, and `AtName.h` for headers or the build system might fail. The macros used to generate the ROOT dictionaries for each library, assumes these file extensions.</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;In general, any class added or modified should try to respect backwards compatibilty. In addition, it should avoid modifying important base classes unless there is a good reason. That is, if you&#39;re adding a feature only used in a certain experiment to a certain class you should extend that class rather then modify it.</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;## Adding a task</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;Each task class (something that inherits from FairTask) should be primarily responsible for setting up the input and output. The logic of the task should be handled by another class, an instance of which is a member of the task class. The goal here is to seperate the IO from the actualy loogic of the task. This makes it easier for someone linking against ATTPCROOT to use the logic without spinning up an entire instance of FairRoot. </div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;## Adding a library</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;Each folder in the root directory names `AtName` will build into a shared object with the name `libAtName` as defined by a `CMakelists.txt` file in each folder. Other folders, (eg macro, icon, parameters, etc), are not built and do not contain a CMakeLists.txt folder. In order for the new library to be built, it must be added as a subdirectory to the global CMakeList.txt in the root directory.</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;## Running tests</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;There is a suite of tests located in `macro/tests` to check the unpacking of AT-TPC, SpecMAT, and GADGET data. It also tests the simulation of AT-TPC data. To run the tests, the following pre-requites must be met:</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;* Generate the required geometry files by running the script `macro/tests/generateGeometry.sh`</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;* GADGETII tests must be run on fishtank (the data is to large to package with the repository)</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;* SpecMAT tests require the ROOT file TTreesGETrun_9993.root be placed in the `macro/tests/SpecMAT/data` folder.</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;To run all tests run the bash script `macro/tests/runAllTest.sh`. To the screen it will print a summary of each test run and the return value. The output of the test scripts run are saved in a text file in each test directory (test.log).</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;### Coverage of tests</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;- [ ] Simulation Coverage</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  * Generators</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    - [ ] AtTPC20MgDecay</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; - [ ] AtTPC2Body</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; - [ ] AtTPC_Background</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; - [ ] AtTPC_d2He</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; - [ ] AtTPCFissionGenerator</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; - [ ] AtTPCFissionGeneratorv2</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; - [x] AtTPCFissionGeneratorv3</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; - [ ] AtTPCGammaDummyGenerator</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; - [ ] AtTPCIonDecay</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; - [x] AtTPCIonGenerator</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; - [ ] AtTPCXSManager</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; - [ ] AtTPCXSReader</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  - [ ] AtAvalanchTask</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  - [x] AtClusterizeLineTask</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  - [ ] AtClusterizeTask</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  - [x] AtPulseLineTask</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  - [ ] AtPulseTask</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  - [ ] AtSpaceChargeTask</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  - [ ] AtTriggerTask</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;- [x] Unpacking Coverage</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  - [x] AtUnpackTask</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    - [x] AtHDFUnpacker</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    - [x] AtROOTUnpacker</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    - [x] AtGRAWUnpacker</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;- [ ] Reconstruction Coverage</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  - [ ] AtAuxFilterTask</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  - [x] AtDataReductionTask</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  - [x] AtFilterTask</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    - [x] AtFilterSubtraction</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; - [ ] AtFilterCalibrate</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; - [ ] AtTrapezoidFilter</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  - [ ] AtFitterTask</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  - [ ] AtLinkDAQtask</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  - [ ] AtPRAtask </div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    - [ ] AtLmedsMod</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; - [ ] AtMlesacMod</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; - [ ] AtPRA</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    - [ ] AtRansacMod</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; - [ ] AtTrackFinderHC</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  - [x] AtPSAtask</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    - [ ] AtCalibration</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; - [ ] AtPSAFilter</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; - [ ] AtPSAFull</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; - [ ] AtPSAProto</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; - [ ] AtPSAProtoFull</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    - [x] AtPSASimple2</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; - [ ] AtPSASimple</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  - [x] AtRansacTask</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    - [x] AtRansac</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  - [ ] AtTrackFinderHCTask</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  </div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;# Creating geometry files</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;### Adding materials</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;Each material that can be used in a detector is defined in the global file `geometry/media.geo`. If you would like to add any new materials, it can be done in that file. The header has detailed instructions for adding new materials.</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;### Creating detectors</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;There are a number of scripts in geometry/ for building detector geometries. Each of these output two root files that are then passed to the simulation code. In these script files, all of the materials of the detector can be changed including the gas in the attpc, and window material. If the ion chamber or some other detector is present those can also be added.</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;The file ATTPC_v1_2.C has the basic geometry for the full sized TPC. The file ATTPC_Proto_v1_0.C ha the basic geometry for the pATTPC. Both of these files are pretty self explanitory if opened.</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;To generate the root files that will be used for the physics simulation just run the macro `root ATTPC_v1_2.C`. The simulation macros will look in the `geometry/` folder for these files.</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;# Running simulations</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;### Generating physics</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;Each &quot;event&quot; is split into two phases, the beam phase and the reaction phase. Internally these are different events. What that means is that events 0 and 1 in the code constitute a full, physical beam induced event. Likewise events 2 and 3 are the next beam induced event, etc.</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;Particles are tracked by an internal counter fTrackID. fTrackID = 0 is the beam. The value these have determine how the TPC detector handles adding the track.</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;The folder `macro/Simulation` holds all of the ROOT macros for physics simulations. These produce two ROOT files, one is the actual output file that holds track information. The other is a parameter file generated by the process. These simulations can be run using either the Geant4 or Geant3 monte-carlo engine.</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;For every simulation, the detector must be created, and a geometry file set. A `FairPrimaryGenerator` must also exist. *This is responsible for managing all of the other generators.(True?)*</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;Typically, an `ATTPCIonGenerator` is used to create the beam. It creates an ion within some beamspot and adds a track to the primary generator. It also generates a random number between 0 and the nominal beam energy (or some other specified value) that is stored in the global instance of `ATVertexPropagator` (gATVP). When the beam particle (TrackID = 0) looses energy equal to this random number, the simulation stops the track. Due to the tracking of the TrackID and `aATVP`&#39;s tracking of the current track number, tracks from the beam/reaction generator are only added when it is the right type of event (even = beam, odd = reaction).</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;#### ATFissionGeneratorV3</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;This class takes two input files. One is a space seperated file that contains a list of every ion used by that fission simulation so they can be registered for the run. The other is root file containing a tree with the simulation data for the fission fragments int he CM frame. It has the structure:</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;trEvents -&gt;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; - nTracks /I</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; - Aout[nTracks] /I</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; - Zout[nTracks] /I</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; - pX[nTracks] /D in units MeV/c</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; - pY[nTracks] /D in units MeV/c</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; - pZ[nTracks] /D in units MeV/c</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; - pT[nTracks] /D in units MeV/c</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;During a run, the generator will boost the fragments before generating the particles to the beam momentum. It pulls the beam momentum from the global vertex propogator. </div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;There is a macro for generating these input files in [macro/Simulation/E12014](macro/Simulation/E12014).</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;# Running Analysis</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;When running analysis in a macro, an instance of FairRunAna is created and tasks added to it. Each task will take in an event, process it, and then pass the event to the next task. Each task can save the intermediary step if desired by setting the boolean flag kIsPersistant.</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;### Unpacking Tasks</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;These tasks are responsible for taking raw data in and saving it in an ATRawEvent class.</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;#### HFD5ParserTask</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;TODO</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;### Pulse Shape Analysis</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;These tasks are responsible for taking an ATRawEvent and saving it as an ATEvent. That is, it takes the waveforms from the pads and process it into an array of ATHits which are the location of charge deposition in the TPC in space.</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;All the different PSA methods are handled by the same task, ATPSAtask. This task can also handle gain and jitter calibration through the class ATCalibration. When constructing the task, a pointer must be passed to a class that derives from the virtual class ATPSA. This derived class handles the logic of the task and the managment of whatever parameters are necessary. Below contains documentation on the various implemented PSA methods, including discriptions of their parameters.</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;#### ATPSASimple</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;TODO</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;#### ATPSASimple2</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;TODO</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;#### ATPSAFull</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;TODO</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;#### ATPSASFilter</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;TODO</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;#### ATPSAProtoFull</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;TODO</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;#### ATPSAProto</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;TODO</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;# Notes on design</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;ATTPCROOT is task based and there are two main input streams of data. One is from simulations, the other experimental data. The two streams come together at the level of waveforms on the pads, either simulated or real. From then on the analysis is identiacal.</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;## Simulation Tasks</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;### FairRunSim</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;Physics (Primary Generators/physics lists) -&gt; MC Tracks</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;### FairRunAna</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;#### ATClusterize task</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;MC Tracks -&gt; e- locations along track (TClonesArray of ATSimulationPoints)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;#### ATPulseTask</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;e- locations along track (TClonesArray of ATSimulationPoints) -&gt; waveform on pads (TClonesArray of ATRawEvent)</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;## Data Tasks</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;### FairRunAna</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;#### HDFParserTask</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;HDF5 file -&gt; waveform on pads (TClonesArray of ATRawEvent)</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;Output is named: &quot;ATRawEvent&quot;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;## Analysis Tasks</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;### FairRunAna</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;#### ATPSATask</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;There are many diffrent options for this task depending on how you want to treat the wavefrom (the standard ATTPC version is ATPSASimple2), but in general:</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;Waveform on pads (TClonesArray of ATRawEvent) -&gt; record of hits, 3D position and charge in tpc, (ATHit) on pad (TClonesArray of ATEvent)</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;Output is named: &quot;ATEventH&quot;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;This task uses the parameters in the ATTPC .par files. In particular this loads (bolded are used by PSASimple):</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;* PadPlaneX (?)</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;* PadSizeX (?)</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;* PadPlaneZ (?)</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;* PadSizeZ (?)</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;* PadRows (?)</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;* PadLayers (?)</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;* **NumTbs (Number of time buckets)**</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;* **TBTTime (Sampling rate in ns)**</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;* **DriftVelocity (cm/us)**</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;* MaxDriftLength (Length of TPC)</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;* BField</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;* EField</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;* TiltAng</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;* TB0 (Depricated: time bucket refrence for micromegas)</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;* EntTB (position in time buckets for detector entrance)</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;#### ATPRATask</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;Has options for RANSAC, Hierarchical Clustering, and Houghs algorithms for track finding.</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;record of hits (TClonesArray of AtEvent) -&gt; record of reconstructed tracks (ATTrack) (TClonesArray of ATPatternEvent)</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
